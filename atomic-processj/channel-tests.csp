include "init.csp"
include "channel-spec.csp"
include "channel.csp"
include "alt-spec.csp"
include "alt.csp"
include "threads.csp"

-- EXPERIMENT PARAMETERS
NUM_RUNNERS = 2
subtype ReaderPID = P1
subtype WriterPID = P2
datatype ChanID = NullChan | C1
subtype NonNullChanID = C1
-- **********************

chan = head(seq(NonNullChanID))

CHANNEL =
(
    SCHEDULER::SCHEDULER_SYSTEM
    [| SCHEDULER::alpha |]
    (
        (
            (
                (||| p : WriterPID @
                     SCHEDULER::START(p); 
                     WRITER(p, chan)
                )
                |||
                (||| p : ReaderPID @
                    SCHEDULER::START(p); 
                    READER(p, chan)
                )
            )
            [| alphaMEM |]
            (CHANNELS ||| PROCESSES)
        ) \ alphaMEM
    )
) \ SCHEDULER::alpha

-- Actual procs to compare
SPEC = ChanSpec::CHAN_SPEC(chan, WriterPID, ReaderPID)
IMPL = CHANNEL

assert IMPL :[deadlock free[FD]]
assert IMPL :[deterministic[FD]]
assert IMPL :[divergence free[FD]]
assert SPEC :[divergence free[FD]]

assert SPEC [T= IMPL
assert IMPL [T= SPEC
assert SPEC [F= IMPL
assert IMPL [F= SPEC